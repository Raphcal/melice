//
//  melstring-test.c
//  melice
//
//  Created by Rapha√´l Calabro on 14/11/2021.
//

#include <stdlib.h>
#include <melice.h>
#include <assert.h>

void testUTF16ToCodePoints(void) {
    // Testing with only ASCII characters: Hello World!
    uint8_t helloWorld[] = {0x48, 0x0, 0x65, 0x0, 0x6c, 0x0, 0x6c, 0x0, 0x6f, 0x0, 0x20, 0x0, 0x57, 0x0, 0x6f, 0x0, 0x72, 0x0, 0x6c, 0x0, 0x64, 0x0, 0x21, 0x0, 0x0, 0x0};
    MELCodePoint expected[] = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21};
    MELCodePointList actual = MELCodePointListMakeWithUTF16String((uint16_t *) helloWorld);
    assert(memcmp(expected, actual.memory, 12 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);

    // Testing with latin-1 characters: a√†e√©√®i√Øo√¥u√π
    uint8_t aeiou[] = {0x61, 0x0, 0xe0, 0x0, 0x65, 0x0, 0xe9, 0x0, 0xe8, 0x0, 0x69, 0x0, 0xef, 0x0, 0x6f, 0x0, 0xf4, 0x0, 0x75, 0x0, 0xf9, 0x0, 0x0, 0x0};
    MELCodePoint expected2[] = {0x61, 0xe0, 0x65, 0xe9, 0xe8, 0x69, 0xef, 0x6f, 0xf4, 0x75, 0xf9};
    actual = MELCodePointListMakeWithUTF16String((uint16_t *) aeiou);
    assert(memcmp(expected2, actual.memory, 5 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);

    // Testing with japanese characters: a„ÅÇi„ÅÑu„ÅÜe„Åào„Åä
    uint8_t aiueo[] = {0x61, 0x0, 0x42, 0x30, 0x69, 0x0, 0x44, 0x30, 0x75, 0x0, 0x46, 0x30, 0x65, 0x0, 0x48, 0x30, 0x6f, 0x0, 0x4a, 0x30, 0x0, 0x0};
    MELCodePoint expected3[] = {0x61, 0x3042, 0x69, 0x3044, 0x75, 0x3046, 0x65, 0x3048, 0x6f, 0x304a};
    actual = MELCodePointListMakeWithUTF16String((uint16_t *) aiueo);
    assert(memcmp(expected3, actual.memory, 10 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);

    // Testing with a flag emoji: Franceüá´üá∑
    uint8_t france[] = {0x46, 0x0, 0x72, 0x0, 0x61, 0x0, 0x6e, 0x0, 0x63, 0x0, 0x65, 0x0, 0x3c, 0xd8, 0xeb, 0xdd, 0x3c, 0xd8, 0xf7, 0xdd, 0x0, 0x0};
    MELCodePoint expected4[] = {0x46, 0x72, 0x61, 0x6e, 0x63, 0x65, 0x1f1eb, 0x1f1f7};
    actual = MELCodePointListMakeWithUTF16String((uint16_t *) france);
    assert(memcmp(expected4, actual.memory, 8 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);
}

void testUTF16ToUTF8(void) {
    // Testing with only ASCII characters: Hello World!
    uint8_t helloWorld[] = {0x48, 0x0, 0x65, 0x0, 0x6c, 0x0, 0x6c, 0x0, 0x6f, 0x0, 0x20, 0x0, 0x57, 0x0, 0x6f, 0x0, 0x72, 0x0, 0x6c, 0x0, 0x64, 0x0, 0x21, 0x0, 0x0, 0x0};
    char *actual = MELUTF8StringMakeWithUTF16String((uint16_t *)helloWorld);
    uint8_t expected[] = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21};
    printf("helloWorld: %s\n", actual);
    assert(strcmp("Hello World!", actual) == 0);
    assert(memcmp(expected, actual, 12) == 0);
    free(actual);

    // Testing with latin-1 characters: a√†e√©√®i√Øo√¥u√π
    uint8_t aeiou[] = {0x61, 0x0, 0xe0, 0x0, 0x65, 0x0, 0xe9, 0x0, 0xe8, 0x0, 0x69, 0x0, 0xef, 0x0, 0x6f, 0x0, 0xf4, 0x0, 0x75, 0x0, 0xf9, 0x0, 0x0, 0x0};
    actual = MELUTF8StringMakeWithUTF16String((uint16_t *)aeiou);
    uint8_t expected2[] = {0x61, 0xc3, 0xa0, 0x65, 0xc3, 0xa9, 0xc3, 0xa8, 0x69, 0xc3, 0xaf, 0x6f, 0xc3, 0xb4, 0x75, 0xc3, 0xb9};
    printf("aeiou: %s\n", actual);
    assert(memcmp(expected2, actual, 17) == 0);
    free(actual);

    // Testing with japanese characters: a„ÅÇi„ÅÑu„ÅÜe„Åào„Åä
    uint8_t aiueo[] = {0x61, 0x0, 0x42, 0x30, 0x69, 0x0, 0x44, 0x30, 0x75, 0x0, 0x46, 0x30, 0x65, 0x0, 0x48, 0x30, 0x6f, 0x0, 0x4a, 0x30, 0x0, 0x0};
    actual = MELUTF8StringMakeWithUTF16String((uint16_t *)aiueo);
    uint8_t expected3[] = {0x61, 0xe3, 0x81, 0x82, 0x69, 0xe3, 0x81, 0x84, 0x75, 0xe3, 0x81, 0x86, 0x65, 0xe3, 0x81, 0x88, 0x6f, 0xe3, 0x81, 0x8a};
    printf("aiueo: %s\n", actual);
    assert(memcmp(expected3, actual, 20) == 0);
    free(actual);

    // Testing with a flag emoji: Franceüá´üá∑
    uint8_t france[] = {0x46, 0x0, 0x72, 0x0, 0x61, 0x0, 0x6e, 0x0, 0x63, 0x0, 0x65, 0x0, 0x3c, 0xd8, 0xeb, 0xdd, 0x3c, 0xd8, 0xf7, 0xdd, 0x0, 0x0};
    actual = MELUTF8StringMakeWithUTF16String((uint16_t *)france);
    uint8_t expected4[] = {0x46, 0x72, 0x61, 0x6e, 0x63, 0x65, 0xf0, 0x9f, 0x87, 0xab, 0xf0, 0x9f, 0x87, 0xb7};
    printf("france: %s\n", actual);
    assert(memcmp(expected4, actual, 14) == 0);
    free(actual);
}

void testUTF8ToCodePoints(void) {
    // Testing with only ASCII characters: Hello World!
    uint8_t helloWorld[] = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21, 0x0};
    MELCodePoint expected[] = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21};
    MELCodePointList actual = MELCodePointListMakeWithUTF8String((char *) helloWorld);
    assert(memcmp(expected, actual.memory, 12 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);

    // Testing with latin-1 characters: a√†e√©√®i√Øo√¥u√π
    uint8_t aeiou[] = {0x61, 0xc3, 0xa0, 0x65, 0xc3, 0xa9, 0xc3, 0xa8, 0x69, 0xc3, 0xaf, 0x6f, 0xc3, 0xb4, 0x75, 0xc3, 0xb9, 0x0};
    MELCodePoint expected2[] = {0x61, 0xe0, 0x65, 0xe9, 0xe8, 0x69, 0xef, 0x6f, 0xf4, 0x75, 0xf9};
    actual = MELCodePointListMakeWithUTF8String((char *) aeiou);
    assert(memcmp(expected2, actual.memory, 5 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);

    // Testing with japanese characters: a„ÅÇi„ÅÑu„ÅÜe„Åào„Åä
    uint8_t aiueo[] = {0x61, 0xe3, 0x81, 0x82, 0x69, 0xe3, 0x81, 0x84, 0x75, 0xe3, 0x81, 0x86, 0x65, 0xe3, 0x81, 0x88, 0x6f, 0xe3, 0x81, 0x8a, 0x0};
    MELCodePoint expected3[] = {0x61, 0x3042, 0x69, 0x3044, 0x75, 0x3046, 0x65, 0x3048, 0x6f, 0x304a};
    actual = MELCodePointListMakeWithUTF8String((char *) aiueo);
    assert(memcmp(expected3, actual.memory, 10 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);

    // Testing with a flag emoji: Franceüá´üá∑
    uint8_t france[] = {0x46, 0x72, 0x61, 0x6e, 0x63, 0x65, 0xf0, 0x9f, 0x87, 0xab, 0xf0, 0x9f, 0x87, 0xb7, 0x0};
    MELCodePoint expected4[] = {0x46, 0x72, 0x61, 0x6e, 0x63, 0x65, 0x1f1eb, 0x1f1f7};
    actual = MELCodePointListMakeWithUTF8String((char *) france);
    assert(memcmp(expected4, actual.memory, 8 * sizeof(uint32_t)) == 0);
    MELCodePointListDeinit(&actual);
}

void testUTF8ToUTF16(void) {
    // Testing with only ASCII characters: Hello World!
    uint8_t helloWorld[] = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21, 0x0};
    uint16_t *actual = MELUTF16StringMakeWithUTF8String((char *)helloWorld);
    uint8_t expected[] = {0x48, 0x0, 0x65, 0x0, 0x6c, 0x0, 0x6c, 0x0, 0x6f, 0x0, 0x20, 0x0, 0x57, 0x0, 0x6f, 0x0, 0x72, 0x0, 0x6c, 0x0, 0x64, 0x0, 0x21, 0x0};
    assert(memcmp(expected, actual, 24) == 0);
    free(actual);

    // Testing with latin-1 characters: a√†e√©√®i√Øo√¥u√π
    uint8_t aeiou[] = {0x61, 0xc3, 0xa0, 0x65, 0xc3, 0xa9, 0xc3, 0xa8, 0x69, 0xc3, 0xaf, 0x6f, 0xc3, 0xb4, 0x75, 0xc3, 0xb9, 0x0};
    actual = MELUTF16StringMakeWithUTF8String((char *)aeiou);
    uint8_t expected2[] = {0x61, 0x0, 0xe0, 0x0, 0x65, 0x0, 0xe9, 0x0, 0xe8, 0x0, 0x69, 0x0, 0xef, 0x0, 0x6f, 0x0, 0xf4, 0x0, 0x75, 0x0, 0xf9, 0x0};
    assert(memcmp(expected2, actual, 22) == 0);
    free(actual);

    // Testing with japanese characters: a„ÅÇi„ÅÑu„ÅÜe„Åào„Åä
    uint8_t aiueo[] = {0x61, 0xe3, 0x81, 0x82, 0x69, 0xe3, 0x81, 0x84, 0x75, 0xe3, 0x81, 0x86, 0x65, 0xe3, 0x81, 0x88, 0x6f, 0xe3, 0x81, 0x8a, 0x0};
    actual = MELUTF16StringMakeWithUTF8String((char *)aiueo);
    uint8_t expected3[] = {0x61, 0x0, 0x42, 0x30, 0x69, 0x0, 0x44, 0x30, 0x75, 0x0, 0x46, 0x30, 0x65, 0x0, 0x48, 0x30, 0x6f, 0x0, 0x4a, 0x30};
    assert(memcmp(expected3, actual, 20) == 0);
    free(actual);

    // Testing with a flag emoji: Franceüá´üá∑
    uint8_t france[] = {0x46, 0x72, 0x61, 0x6e, 0x63, 0x65, 0xf0, 0x9f, 0x87, 0xab, 0xf0, 0x9f, 0x87, 0xb7, 0x0};
    actual = MELUTF16StringMakeWithUTF8String((char *)france);
    uint8_t expected4[] = {0x46, 0x0, 0x72, 0x0, 0x61, 0x0, 0x6e, 0x0, 0x63, 0x0, 0x65, 0x0, 0x3c, 0xd8, 0xeb, 0xdd, 0x3c, 0xd8, 0xf7, 0xdd};
    assert(memcmp(expected4, actual, 20) == 0);
    free(actual);
}

int main(int argc, char **argv) {
    testUTF16ToCodePoints();
    testUTF16ToUTF8();
    testUTF8ToCodePoints();
    testUTF8ToUTF16();
    return EXIT_SUCCESS;
}
